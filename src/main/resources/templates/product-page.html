<!DOCTYPE html>
<html lang="hr">
  <head>
    <th:block th:insert="~{fragments/head :: head}"></th:block>
    <title th:text="${product.name} + ' | Pčelarstvo Pavlović'"></title>
  </head>
  <body>
    <th:block th:insert="~{fragments/header :: header}"></th:block>

    <main class="flex flex-col items-center relative">
      <div
        th:if="${successMessage}"
        x-data="{ show: true }"
        x-show="show"
        x-init="setTimeout(() => show = false, 10000)"
        x-transition:leave="transition ease-out duration-1000"
        x-transition:leave-start="opacity-100"
        x-transition:leave-end="opacity-0"
        class="absolute top-0 flex items-center w-full z-10 p-4 mb-4 text-sm text-green-800 border border-green-300 rounded-lg bg-green-100 dark:bg-gray-700 dark:text-green-400 dark:border-green-800"
        role="alert"
      >
        <svg
          class="flex-shrink-0 inline w-4 h-4 mr-3"
          aria-hidden="true"
          xmlns="http://www.w3.org/2000/svg"
          fill="currentColor"
          viewBox="0 0 20 20"
        >
          <path
            d="M10 .5a9.5 9.5 0 1 0 9.5 9.5A9.51 9.51 0 0 0 10 .5ZM9.5 4a1.5 1.5 0 1 1 0 3 1.5 1.5 0 0 1 0-3ZM12 15H8a1 1 0 0 1 0-2h1v-3H8a1 1 0 0 1 0-2h2a1 1 0 0 1 1 1v4h1a1 1 0 0 1 0 2Z"
          />
        </svg>
        <span class="sr-only">Uspješno</span>
        <div>
          <span class="font-medium" th:text="${successMessage}"></span>
        </div>
      </div>
      <!-- th:src="'/img/' + ${product.image}" -->
      <div class="md:flex flex-col gap-8 md:w-3/5 w-full mt-0 md:mt-8 mb-8">
        <div class="md:flex items-center gap-8">
          <img
            src="/img/med-primjer.jpeg"
            alt="Slika proizvoda"
            class="md:w-96 w-full md:rounded-lg pointer-events-none"
          />
          <div class="flex flex-col gap-4 p-2">
            <div class="flex items-center">
              <p th:text="${product.name}" class="text-4xl font-semibold"></p>
              <svg
                class="w-8 h-8 fill-amber-300 ml-4"
                xmlns="http://www.w3.org/2000/svg"
                viewBox="0 0 24 24"
              >
                <path d="M0 0h24v24H0V0z" fill="none" />
                <path
                  d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"
                />
                <path d="M0 0h24v24H0z" fill="none" />
              </svg>
              <p
                th:if="${averageReviewStar != 0.0}"
                th:text="${averageReviewStar}"
                class="text-xl font-semibold"
              ></p>
              <p th:unless="${averageReviewStar != 0.0}">0 recenzija</p>
            </div>
            <p
              th:text="${product.price} + ' &euro;'"
              class="text-2xl font-semibold"
            ></p>
            <p th:text="${'Pakiranje: ' + product.grams + ' g'}"></p>
            <p th:text="${'Kategorija: ' + product.type}"></p>
            <p th:if="${product.onStock}" class="flex items-center">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                fill="none"
                viewBox="0 0 24 24"
                stroke-width="1.5"
                stroke="currentColor"
                class="w-6 h-6 text-green-600"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  d="M9 12.75 11.25 15 15 9.75M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"
                />
              </svg>

              Dostupno odmah
            </p>
            <p th:unless="${product.onStock}" class="flex items-center">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                fill="none"
                viewBox="0 0 24 24"
                stroke-width="1.5"
                stroke="currentColor"
                class="w-6 h-6 text-red-600"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  d="m9.75 9.75 4.5 4.5m0-4.5-4.5 4.5M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"
                />
              </svg>

              Trenutno nedostupno
            </p>
            <form th:action="@{/kosarica/dodaj}" method="post">
              <div class="mt-8">
                <label for="amount">Količina</label>
                <div class="flex items-center">
                  <span
                    class="p-2.5 bg-gray-200 dark:bg-neutral-900 dark:text-gray-50 cursor-pointer rounded-s-lg text-xl"
                    id="decrement"
                  >
                    -
                  </span>
                  <input
                    id="amount"
                    name="amount"
                    type="text"
                    class="input w-10 text-center rounded-none border-2 border-gray-200 dark:border-neutral-800"
                    readonly
                  />
                  <span
                    class="p-2.5 bg-gray-200 dark:bg-neutral-900 dark:text-gray-50 cursor-pointer rounded-e-lg text-xl"
                    id="increment"
                  >
                    +
                  </span>
                </div>
              </div>

              <input type="hidden" name="totalPrice" id="hiddenTotalPrice" />
              <input type="hidden" name="productId" th:value="${product.id}" />

              <button
                type="submit"
                class="button flex items-center justify-center gap-2 text-center w-full mt-4"
              >
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  class="w-6 h-6 hover:cursor-pointer"
                  viewBox="0 0 24 24"
                >
                  <path
                    fill="currentColor"
                    d="M7 22q-.825 0-1.412-.587T5 20q0-.825.588-1.412T7 18q.825 0 1.413.588T9 20q0 .825-.587 1.413T7 22m10 0q-.825 0-1.412-.587T15 20q0-.825.588-1.412T17 18q.825 0 1.413.588T19 20q0 .825-.587 1.413T17 22M6.15 6l2.4 5h7l2.75-5zM5.2 4h14.75q.575 0 .875.513t.025 1.037l-3.55 6.4q-.275.5-.737.775T15.55 13H8.1L7 15h12v2H7q-1.125 0-1.7-.987t-.05-1.963L6.6 11.6L3 4H1V2h3.25zm3.35 7h7z"
                  />
                </svg>
                Dodaj u košaricu
              </button>
            </form>
          </div>
        </div>
        <div class="p-2">
          <h2 class="text-xl font-semibold mb-4">Opis proizvoda</h2>
          <p th:text="${product.description}" class="leading-relaxed"></p>
        </div>
        <div class="p-2">
          <h2
            class="text-xl font-semibold mb-4"
            th:text="'Recenzije (' + ${allProductReviews.size} + ')'"
          ></h2>
          <div class="gap-4 flex flex-col mb-4">
            <div th:if="${allProductReviews.size == 0}">
              Ovaj proizvod još nema recenziju.
            </div>
            <div
              th:each="review : ${limitedProductReviews}"
              class="shadow-md border dark:bg-neutral-900 rounded-lg dark:border-neutral-600 p-4 text-lg gap-4 flex flex-col"
            >
              <div class="flex justify-between">
                <p th:text="${review.name}" class="font-semibold"></p>
                <p th:text="${review.createdAt}"></p>
              </div>
              <div class="flex items-center">
                <template
                  th:each="star : ${#numbers.sequence(1, 5)}"
                  th:remove="tag"
                  th:with="isFilled=${star le review.stars}"
                >
                  <svg
                    class="w-8 h-8 fill-current"
                    th:classappend="${isFilled} ? 'text-amber-300' : 'text-gray-300'"
                    xmlns="http://www.w3.org/2000/svg"
                    viewBox="0 0 24 24"
                  >
                    <path d="M0 0h24v24H0V0z" fill="none" />
                    <path
                      d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"
                    />
                    <path d="M0 0h24v24H0z" fill="none" />
                  </svg>
                </template>
              </div>

              <p th:text="${review.message}"></p>
            </div>
            <div
              th:if="${allProductReviews.size > 3}"
              class="flex justify-end"
              x-data="{ reviewModelOpen: false }"
            >
              <button
                class="text-sm font-semibold text-gray-900 dark:text-gray-50"
                @click="reviewModelOpen =!reviewModelOpen"
              >
                Prikaži sve &rarr;
              </button>

              <div
                x-show="reviewModelOpen"
                class="fixed inset-0 z-50 overflow-y-auto"
                aria-labelledby="modal-title"
                role="dialog"
                aria-modal="true"
              >
                <div
                  class="flex items-end justify-center min-h-screen px-4 text-center md:items-center sm:block sm:p-0"
                >
                  <div
                    x-cloak
                    @click="reviewModelOpen = false"
                    x-show="reviewModelOpen"
                    x-transition:enter="transition ease-out duration-300 transform"
                    x-transition:enter-start="opacity-0"
                    x-transition:enter-end="opacity-100"
                    x-transition:leave="transition ease-in duration-200 transform"
                    x-transition:leave-start="opacity-100"
                    x-transition:leave-end="opacity-0"
                    class="fixed inset-0 transition-opacity bg-gray-500 bg-opacity-40"
                    aria-hidden="true"
                  ></div>

                  <div
                    x-cloak
                    x-show="reviewModelOpen"
                    x-transition:enter="transition ease-out duration-300 transform"
                    x-transition:enter-start="opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95"
                    x-transition:enter-end="opacity-100 translate-y-0 sm:scale-100"
                    x-transition:leave="transition ease-in duration-200 transform"
                    x-transition:leave-start="opacity-100 translate-y-0 sm:scale-100"
                    x-transition:leave-end="opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95"
                    class="inline-block w-full max-w-xl p-8 my-12 overflow-hidden text-left transition-all transform bg-white dark:bg-neutral-800 rounded-lg shadow-xl 2xl:max-w-2xl"
                  >
                    <div class="flex items-center justify-between space-x-4">
                      <h1 class="text-xl font-medium text-gray-800 mb-8">
                        Proizvod:
                        <span
                          th:text="${product.name + ' (' + allProductReviews.size + ' recenzije) '}"
                        ></span>
                      </h1>

                      <button
                        @click="reviewModelOpen = false"
                        class="text-gray-600 focus:outline-none hover:text-gray-700 pb-6"
                      >
                        <svg
                          xmlns="http://www.w3.org/2000/svg"
                          fill="none"
                          viewBox="0 0 24 24"
                          stroke-width="1.5"
                          stroke="currentColor"
                          class="w-6 h-6 dark:text-gray-50"
                        >
                          <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            d="M6 18L18 6M6 6l12 12"
                          />
                        </svg>
                      </button>
                    </div>
                    <div
                      th:each="review : ${allProductReviews}"
                      class="shadow-md mb-4 border dark:bg-neutral-900 rounded-lg dark:border-neutral-600 p-4 text-lg gap-4 flex flex-col"
                    >
                      <div class="flex justify-between">
                        <p th:text="${review.name}" class="font-semibold"></p>
                        <p th:text="${review.createdAt}"></p>
                      </div>
                      <div class="flex items-center">
                        <template
                          th:each="star : ${#numbers.sequence(1, 5)}"
                          th:remove="tag"
                          th:with="isFilled=${star le review.stars}"
                        >
                          <svg
                            class="w-8 h-8 fill-current"
                            th:classappend="${isFilled} ? 'text-amber-300' : 'text-gray-300'"
                            xmlns="http://www.w3.org/2000/svg"
                            viewBox="0 0 24 24"
                          >
                            <path d="M0 0h24v24H0V0z" fill="none" />
                            <path
                              d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"
                            />
                            <path d="M0 0h24v24H0z" fill="none" />
                          </svg>
                        </template>
                      </div>

                      <p th:text="${review.message}"></p>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="flex flex-col items-center gap-8">
          <h2 class="text-xl font-semibold text-center leading-relaxed">
            Kupili ste ovaj proizvod?<br />Ostavite recenziju!
          </h2>
          <form
            th:action="@{'/proizvodi/' + ${product.id} + '/recenzija'}"
            method="post"
            class="space-y-4"
          >
            <input type="hidden" id="stars" name="stars" value="0" />

            <div>
              <label for="name">Ime i prezime *</label>
              <input
                type="text"
                id="name"
                name="name"
                placeholder="Vaše ime i prezime"
                required
                class="input w-full"
                autocomplete="name"
              />
            </div>
            <p>Ocjena *</p>
            <div x-data="starRating()" class="flex">
              <template x-for="star in stars" :key="star" id="stars">
                <svg
                  @click="setRating(star)"
                  class="w-8 h-8 fill-current cursor-pointer"
                  :class="{ 'text-amber-300': star <= rating, 'text-gray-300': star > rating }"
                  xmlns="http://www.w3.org/2000/svg"
                  viewBox="0 0 24 24"
                >
                  <path d="M0 0h24v24H0V0z" fill="none" />
                  <path
                    d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"
                  />
                  <path d="M0 0h24v24H0z" fill="none" />
                </svg>
              </template>
            </div>

            <div>
              <label for="message">Poruka (neobavezno)</label>
              <textarea
                id="message"
                name="message"
                placeholder="..."
                rows="4"
                class="input lg:w-96 h-48 resize-none"
              ></textarea>
            </div>
            <div class="flex flex-col">
              <input type="submit" value="Pošalji" class="button" />
            </div>
          </form>
        </div>
      </div>
    </main>

    <th:block th:insert="~{fragments/footer :: footer}"></th:block>

    <script th:inline="javascript">
      var amountInput = document.getElementById("amount");
      var hiddenTotalPriceInput = document.getElementById("hiddenTotalPrice");

      var productPrice = /*[[${product.price}]]*/ 0;

      var amount = 1;

      function updateTotalPrice() {
        var totalPrice = amount * productPrice;
        hiddenTotalPriceInput.value = totalPrice;
      }

      function starRating() {
        return {
          rating: 0,
          stars: [1, 2, 3, 4, 5],
          setRating(star) {
            this.rating = star;
            document.getElementById("stars").value = star;
          },
        };
      }

      document.addEventListener("DOMContentLoaded", function () {
        amountInput.value = amount;
        updateTotalPrice();
      });

      document
        .getElementById("decrement")
        .addEventListener("click", function () {
          if (amount > 1) {
            amount--;
            amountInput.value = amount;
            updateTotalPrice();
          }
        });

      document
        .getElementById("increment")
        .addEventListener("click", function () {
          amount++;
          amountInput.value = amount;
          updateTotalPrice();
        });
    </script>
  </body>
</html>
